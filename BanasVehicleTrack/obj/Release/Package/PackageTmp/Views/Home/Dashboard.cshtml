@model BanasVehicleTrackViewModel.DashboardViewModel
@{
    ViewBag.Title = "Home Page";
}
<style>
    .mytooltip .tooltip-item {
        background: none !important;
    }
</style>
<div class="page-wrapper">

    <div class="page-body">
        <div class="row">
            <div class="col-md-8 p-0">
                <div class="breadcrumb-header col form-inline">
                    <h2 class="mr-2">
                        <i class="fa fa-home"></i>
                    </h2>
                    <h2>Dashboard</h2>
                </div>
            </div>
            <div class="col-md-4">
                <a class="btn btn-primary pull-right" href="@Url.Action("ViewGatepass","GatePass")" target="_blank">   <i class="ti-truck mx-2"></i>View/Create Gate Pass</a>
            </div>
        </div>
    </div>
</div>

<div class="page-wrapper">

    <div class="page-body">
        <div class="row">

            @foreach (var item in Model.DashboardCounts)
            {

                <!-- Total Counts Start -->

                <div class="col-xl-4 col-md-6">
                    <div class="card bg-c-yellow update-card">
                        <div class="card-block">
                            <div class="row align-items-end">
                                <div class="col-8">
                                    <h4 class="text-white">@item.EmployeeCount</h4>
                                    <h6 class="text-white m-b-0">Total Employees</h6>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="@Url.Action("ViewEmployeeMaster","Master")" target="_blank">  <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p></a>
                        </div>
                    </div>
                </div>
                @*<div class="col-xl-4 col-md-6">
                        <div class="card bg-c-green update-card">
                            <div class="card-block">
                                <div class="row align-items-end">
                                    <div class="col-8">
                                        <h4 class="text-white">@item.AuditorCount</h4>
                                        <h6 class="text-white m-b-0">Total Audit Officers</h6>
                                    </div>

                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="@Url.Action("ViewAuditorMaster","Master")">  <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p></a>
                            </div>
                        </div>
                    </div>*@

                <div class="col-xl-4 col-md-6">
                    <div class="card bg-c-blue update-card">
                        <div class="card-block">
                            <div class="row align-items-end">
                                <div class="col-8">
                                    <h4 class="text-white">@item.SecurityCount</h4>
                                    <h6 class="text-white m-b-0">Total Security Officers</h6>
                                </div>

                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="@Url.Action("ViewSecurityMaster","Master")" target="_blank">  <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p></a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 col-md-6">
                    <div class="card bg-c-sky  update-card">
                        <div class="card-block">
                            <div class="row align-items-end">
                                <div class="col-8">
                                    <h4 class="text-white">@item.TotalVehicle</h4>
                                    <h6 class="text-white m-b-0">Total Vehicles</h6>
                                </div>

                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="@Url.Action("ViewVehicleMaster","Master")" target="_blank">  <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p></a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 col-md-6">
                    <div class="card bg-c-orenge  update-card">
                        <div class="card-block">
                            <div class="row align-items-end">
                                <div class="col-8">
                                    <h4 class="text-white">@item.TodayGatePass</h4>
                                    <h6 class="text-white m-b-0">Today Gate Passes</h6>
                                </div>

                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="@Url.Action("ViewGatePass","GatePass")" target="_blank">  <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p></a>
                        </div>
                    </div>
                </div>

                <div class="col-xl-4 col-md-6">
                    <div class="card bg-c-green update-card">
                        <div class="card-block">
                            <div class="row align-items-end">
                                <div class="col-8">
                                    <h4 class="text-white">@item.OpenGatePass</h4>
                                    <h6 class="text-white m-b-0">Open GatePasses</h6>
                                </div>

                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="@Url.Action("ViewGatePass", "GatePass", new { filterValue = "Open" })" target="_blank"> <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p></a>
                        </div>
                    </div>
                </div>


                <div class="col-xl-4 col-md-6">
                    <div class="card bg-c-pink  update-card">
                        <div class="card-block">
                            <div class="row align-items-end">
                                <div class="col-8">
                                    <h4 class="text-white">@item.CloseGatePass</h4>
                                    <h6 class="text-white m-b-0">Close GatePasses</h6>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            @*<a href="@Url.Action("ViewGatePass", "GatePass", new { filterValue = "Close" })"  target = "_blank"> <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p></a>*@
                            @if (item.CloseGatePass == 0)
                            {
                                <p class="text-white m-b-0">No Data Found</p>
                            }
                            else
                            {
                                <a href="@Url.Action("ViewGatePass", "GatePass", new { filterValue = "Close" })" target="_blank">
                                    <p class="text-white m-b-0"><i class="fa fa-external-link text-white f-14 m-r-10"></i>Click here</p>
                                </a>
                            }
                        </div>
                    </div>
                </div>
                <!-- Total Counts End -->
            }

            <!-- List -->
            <div class="col-xl-12 col-md-12">
                <div class="card table-card">
                    <div class="card-header">
                        <h5>Gate Pass List</h5>
                        <div class="card-header-right">
                            <ul class="list-unstyled card-option">
                                <li><i class="feather icon-maximize full-card"></i></li>
                                <li><i class="feather icon-minus minimize-card"></i></li>
                                <li><i class="ti-close close-card"></i></li>
                            </ul>
                        </div>
                    </div>

                    <div class="card-block">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="d-flex align-items-center mb-0">
                                            Select Number Of Gatepass :
                                            <select class="form-control ml-2" name="state" id="maxRows" style="width:50%">
                                                <option value="5000">Show ALL Rows</option>
                                                <option value="5">5</option>
                                                <option value="10">10</option>
                                                <option value="15">15</option>
                                                <option value="20">20</option>
                                                <option value="50">50</option>
                                                <option value="70">70</option>
                                                <option value="100">100</option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table id="dashboardTbl" class="table table-hover table-borderless">
                                <thead>
                                    <tr>
                                        <th>Sr No</th>
                                        <th>GatePass Status</th>
                                        <th>GatePass Id</th>
                                        <th>Usercode</th>
                                        <th>Other-User 1</th>
                                        <th>Other-User 2</th>
                                        <th>Other-User 3</th>
                                        <th>Visit Date Time</th>
                                        <th>Close Date Time</th>
                                        <th>Start Odometer</th>
                                        <th>Close Odometer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        int serialNumber = 1;
                                    }
                                    @foreach (var item in Model.DashboardList)
                                    {

                                        <tr>
                                            <td>
                                                @serialNumber
                                            </td>
                                            <td>
                                                @if (item.GatePassStatus == 1)
                                                {
                                                    <label class="text-success">Open</label>
                                                }
                                                else
                                                {
                                                    <label class="text-danger">Close</label>
                                                }
                                            </td>
                                            <td class="text-c-blue">@item.GatePassId</td>
                                            <td>@item.UserCode</td>
                                            <td>@item.OtherUser1</td>
                                            <td>@item.OtherUser2</td>
                                            <td>@item.OtherUser3</td>
                                            <td>@item.VisitDateTime</td>
                                            <td>@item.CloseDateTime</td>
                                            <td>@item.StartOdometer</td>
                                            <td>@item.CloseOdometer</td>
                                        </tr>
                                        serialNumber++;
                                    }
                                </tbody>
                            </table>
                            <div class="text-center">
                                <a href="@Url.Action("ViewGatePass","GatePass")" target="_blank" class=" b-b-primary text-primary">View all</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>


    function getPagination(table) {
        var lastPage = 1;

        $('#maxRows')
            .on('change', function (evt) {
                //$('.paginationprev').html('');

                lastPage = 1;
                $('.pagination')
                    .find('li')
                    .slice(1, -1)
                    .remove();
                var trnum = 0; // reset tr counter
                var maxRows = parseInt($(this).val()); // get Max Rows from select option

                if (maxRows == 5000) {
                    $('.pagination').hide();
                } else {
                    $('.pagination').show();
                }

                var totalRows = $(table + ' tbody tr').length; // numbers of rows
                $(table + ' tr:gt(0)').each(function () {
                    // each TR in  table and not the header
                    trnum++; // Start Counter
                    if (trnum > maxRows) {
                        // if tr number gt maxRows

                        $(this).hide(); // fade it out
                    }
                    if (trnum <= maxRows) {
                        $(this).show();
                    } // else fade in Important in case if it ..
                }); //  was fade out to fade it in
                if (totalRows > maxRows) {
                    // if tr total rows gt max rows option
                    var pagenum = Math.ceil(totalRows / maxRows); // ceil total(rows/maxrows) to get ..
                    //	numbers of pages
                    for (var i = 1; i <= pagenum;) {
                        // for each page append pagination li
                        $('.pagination #prev')
                            .before(
                                '<li data-page="' +
                                i +
                                '">\
                                  <span>' +
                                i++ +
                                '<span class="sr-only">(current)</span></span>\
                                </li>'
                            )
                            .show();
                    } // end for i
                } // end if row count > max rows
                $('.pagination [data-page="1"]').addClass('active'); // add active class to the first li
                $('.pagination li').on('click', function (evt) {
                    // on click each page
                    evt.stopImmediatePropagation();
                    evt.preventDefault();
                    var pageNum = $(this).attr('data-page'); // get it's number

                    var maxRows = parseInt($('#maxRows').val()); // get Max Rows from select option

                    if (pageNum == 'prev') {
                        if (lastPage == 1) {
                            return;
                        }
                        pageNum = --lastPage;
                    }
                    if (pageNum == 'next') {
                        if (lastPage == $('.pagination li').length - 2) {
                            return;
                        }
                        pageNum = ++lastPage;
                    }

                    lastPage = pageNum;
                    var trIndex = 0; // reset tr counter
                    $('.pagination li').removeClass('active'); // remove active class from all li
                    $('.pagination [data-page="' + lastPage + '"]').addClass('active'); // add active class to the clicked
                    // $(this).addClass('active');					// add active class to the clicked
                    limitPagging();
                    $(table + ' tr:gt(0)').each(function () {
                        // each tr in table not the header
                        trIndex++; // tr index counter
                        // if tr index gt maxRows*pageNum or lt maxRows*pageNum-maxRows fade if out
                        if (
                            trIndex > maxRows * pageNum ||
                            trIndex <= maxRows * pageNum - maxRows
                        ) {
                            $(this).hide();
                        } else {
                            $(this).show();
                        } //else fade in
                    }); // end of for each tr in table
                }); // end of on click pagination list
                limitPagging();
            })
            .val(5)
            .change();

        // end of on select change

        // END OF PAGINATION
    }

    function limitPagging() {
        // alert($('.pagination li').length)

        if ($('.pagination li').length > 7) {
            if ($('.pagination li.active').attr('data-page') <= 3) {
                $('.pagination li:gt(5)').hide();
                $('.pagination li:lt(5)').show();
                $('.pagination [data-page="next"]').show();
            } if ($('.pagination li.active').attr('data-page') > 3) {
                $('.pagination li:gt(0)').hide();
                $('.pagination [data-page="next"]').show();
                for (let i = (parseInt($('.pagination li.active').attr('data-page')) - 2); i <= (parseInt($('.pagination li.active').attr('data-page')) + 2); i++) {
                    $('.pagination [data-page="' + i + '"]').show();

                }

            }
        }
    }

    $(function () {
        // Just to append id number for each row
        $('table tr:eq(0)').prepend('<th> ID </th>');

        var id = 0;

        $('table tr:gt(0)').each(function () {
            id++;
            $(this).prepend('<td>' + id + '</td>');
        });
    });

    //  Developed By Yasser Mas
    // yasser.mas2@gmail.com

    $(document).ready(function () {
        getPagination('#dashboardTbl');
    });
</script>